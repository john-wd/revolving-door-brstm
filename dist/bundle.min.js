!function(){"use strict";function t(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(s){var i=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,i.get?i:{enumerable:!0,get:function(){return t[s]}})})),e}class e{constructor(){this.registerOpEvent=function(t,e){if(this.operationListeners.has(t)){let s=this.operationListeners.get(t);s.push(e),this.operationListeners.set(t,s)}else this.operationListeners.set(t,[e])},this.registerFinEvent=function(t,e){if(this.finishedListeners.has(t)){let s=this.finishedListeners.get(t);s.push(e),this.finishedListeners.set(t,s)}else this.finishedListeners.set(t,[e])},this.currentlyGesturing=!1,this.activeArea="",this.activeAreaElem=null,this.operationListeners=new Map,this.finishedListeners=new Map}sanitize(t,e){let s=this.activeAreaElem.getBoundingClientRect(),i=t-s.x,a=e-s.y;return i<0&&(i=0),a<0&&(a=0),i>s.width&&(i=s.width),a>s.height&&(a=s.height),[i,a]}fireOp(t,e,s){if(this.operationListeners.has(t))for(let i=0;i<this.operationListeners.get(t).length;i++)this.operationListeners.get(t)[i](e,s)}fireFin(t,e,s){if(this.finishedListeners.has(t))for(let i=0;i<this.finishedListeners.get(t).length;i++)this.finishedListeners.get(t)[i](e,s)}runGestureEngine(){i()}}let s=new e;function i(){document.addEventListener("mousedown",(function(t){if(t.target.dataset.gestureHitzone){s.currentlyGesturing=!0,s.activeArea=t.target.dataset.gestureHitzone,s.activeAreaElem=t.target;let[e,i]=s.sanitize(t.clientX,t.clientY);s.fireOp(s.activeArea,e,i)}})),document.addEventListener("mousemove",(function(t){if(s.currentlyGesturing){let[e,i]=s.sanitize(t.clientX,t.clientY);s.fireOp(s.activeArea,e,i)}})),document.addEventListener("mouseup",(function(t){if(s.currentlyGesturing){let[e,i]=s.sanitize(t.clientX,t.clientY);s.fireFin(s.activeArea,e,i),s.currentlyGesturing=!1,s.activeAreaElem=null,s.activeArea=""}}))}var a,n,o=t(Object.freeze({__proto__:null,getInstance:function(){return null==s&&(s=new e),s},runGestureEngine:i})),r=(a=function(t){const e=o.getInstance();let s={position:0,samples:1e6,loaded:5e5,volume:1,paused:!1,ready:!1,buffering:!1,sampleRate:48e3,looping:!1,streamingDied:!1},i={volume:null,position:null},a={},n=null,r=null,l=null,h=-30;function u(e){try{e.preventDefault()}catch(t){}if(e.targetTouches.length>0){let n=e.targetTouches[0].target.getBoundingClientRect(),o=e.targetTouches[0].clientY+e.targetTouches[0].radiusY-n.top;o<5&&(o=0),o>80&&(o=84);let r=1-o/84;i.volume=r,"touchend"===e.type&&(s.volume=i.volume,a.setVolume(i.volume),i.volume=null,localStorage.setItem("volumeoverride",r)),t.exports.guiUpdate()}else"touchend"===e.type&&(s.volume=i.volume,a.setVolume(i.volume),i.volume=null)}function d(e){try{e.preventDefault()}catch(t){}if(e.targetTouches.length>0){let n=e.targetTouches[0].target.getBoundingClientRect(),o=e.targetTouches[0].clientX+e.targetTouches[0].radiusX-n.left;if(o<5&&(o=0),o>254&&(o=254),o=Math.round(o),o===h)return;h=o;let r=s.samples*(o/254);r<s.loaded&&(i.position=r),"touchend"===e.type&&(a.seek(i.position),i.position=null),t.exports.guiUpdate()}else"touchend"===e.type&&(a.seek(i.position),i.position=null)}function c(e,a){let n=Math.round(e),o=s.samples*(n/254);o<s.loaded&&(i.position=o),t.exports.guiUpdate()}function p(e,n){let o=Math.round(e),r=s.samples*(o/254);r<s.loaded&&(i.position=r),a.seek(r),i.position=null,t.exports.guiUpdate()}function f(e,s){s=Math.round(s),i.volume=1-s/84,t.exports.guiUpdate()}function m(e,s){let n=1-(s=Math.round(s))/84;i.volume=null,localStorage.setItem("volumeoverride",n),a.setVolume(n),t.exports.guiUpdate()}t.exports.updateState=function(t){Object.assign(s,t)},t.exports.runGUI=function(i){a=i,l=document.createElement("div"),l.classList.add("guiholder"),l.innerHTML='\n<div class="error" style="display: none">\n    <h3>Playback failed!</h3>\n    <h3>Reload the page and try again.</h3>\n    <h3>If the issue continues, contact us.</h3>\n</div>\n<div id="gui-loading-bar">\n    <div id="gui-inner-loading-bar"></div>\n</div>\n<div class="guistate" data-guistate="preload">\n    <h3>Loading song...</h3>\n</div>\n<div class="guistate" data-guistate="ready">\n    <div id="pl-pause-play">\n        <svg width="48" height="48" viewBox="0 0 48 48" id="pl-play">\n            <path d="M 10, 10 l 0, 28 l 28, -14" fill="white"></path>\n        </svg>\n        <svg width="48" height="48" viewBox="0 0 48 48" id="pl-pause" style="display: none;">\n            <path d="M 10, 10 l 0, 28 l 10, 0 l 0, -28 M 28, 10 l 0, 28 l 10, 0 l 0, -28" fill="white"></path>\n        </svg>\n    </div>\n    <canvas id="pl-volume" width="16" height="84" data-gesture-hitzone="volume"></canvas>\n    <div id="pl-timing">\n        <span id="pl-time-start">0:00</span>\n        <span id="pl-time-end"  >0:00</span>\n    </div>\n    <canvas id="pl-seek" width="254" height="16" data-gesture-hitzone="seek"></canvas>\n    <div id="pl-loop">\n        <input type="checkbox" id="pl-loop-box" style="width: 16px; height: 16px; margin: 0;">\n        <span class="pl-loop-text">Enable loop</span>\n        <a class="pl-loop-text" target="_blank" href="https://smashcustommusic.net/feedback/">Send feedback</a>\n        <a class="pl-loop-text" target="_blank" href="https://github.com/rphsoftware/revolving-door">v2 by Rph</a>\n    </div>\n</div>',document.body.appendChild(l),n=document.querySelector("#pl-volume").getContext("2d"),r=document.querySelector("#pl-seek").getContext("2d"),document.querySelector("#pl-volume").addEventListener("touchstart",u),document.querySelector("#pl-volume").addEventListener("touchmove",u),document.querySelector("#pl-volume").addEventListener("touchend",u),document.querySelector("#pl-seek").addEventListener("touchstart",d),document.querySelector("#pl-seek").addEventListener("touchmove",d),document.querySelector("#pl-seek").addEventListener("touchend",d),document.querySelector("#pl-pause-play").addEventListener("click",(function(){a.playPause(),t.exports.guiUpdate()})),document.querySelector("#pl-loop-box").addEventListener("input",(function(){s.looping=document.querySelector("#pl-loop-box").checked,a.setLoop(s.looping)})),l.addEventListener("drag",(function(t){t.preventDefault()})),e.runGestureEngine(),e.registerOpEvent("seek",c),e.registerFinEvent("seek",p),e.registerOpEvent("volume",f),e.registerFinEvent("volume",m)};let g=null,y=null,v=-1,_=-1,w=null,b=-1,S=-1,k=null,x=-1,R=null;t.exports.destroyGui=function(){l&&l.remove()},t.exports.guiUpdate=function(){if(l){R!==s.streamingDied&&(l.querySelector(".error").style.display=s.streamingDied?"flex":"none",R=s.streamingDied);let t=s.buffering||!s.ready;if(g!==t&&(l.querySelector("#gui-loading-bar").dataset.exists=t,g=t),y!==s.ready&&(l.querySelector('.guistate[data-guistate="preload"]').style.display=s.ready?"none":"block",l.querySelector('.guistate[data-guistate="ready"]').style.display=s.ready?"grid":"none",y=s.ready),!s.ready)return;let e=Math.round(84-84*s.volume);null!==i.volume&&(e=Math.round(84-84*i.volume)),e!==v&&(n.fillStyle="#444",n.fillRect(0,0,16,84),n.fillStyle="hsl(200, 85%, 55%)",n.fillRect(0,e,16,84),v=e);let a=Math.ceil(s.position/s.samples*254);null!==i.position&&(a=Math.ceil(i.position/s.samples*254));let o=Math.ceil(s.loaded/s.samples*254);a===_&&o===x||(r.fillStyle="#222",r.fillRect(0,0,254,16),r.fillStyle="#666",r.fillRect(0,0,Math.min(254,o),16),r.fillStyle="hsl(200, 85%, 55%)",r.fillRect(0,0,Math.min(254,a),16),_=a,x=o),w!==s.paused&&(l.querySelector("#pl-pause").style.display=s.paused?"none":"block",l.querySelector("#pl-play").style.display=s.paused?"block":"none",w=s.paused);let h=Math.floor(s.samples/s.sampleRate),u=Math.floor(s.position/s.sampleRate);null!==i.position&&(u=Math.floor(i.position/s.sampleRate)),h!==b&&(l.querySelector("#pl-time-end").innerText=`${Math.floor(h/60)}:${(h%60).toString().padStart(2,"0")}`,b=h),u!==S&&(l.querySelector("#pl-time-start").innerText=`${Math.floor(u/60)}:${(u%60).toString().padStart(2,"0")}`,S=u),k!==s.looping&&(l.querySelector("#pl-loop-box").checked=s.looping,k=s.looping)}}},a(n={exports:{}},n.exports),n.exports);const l=Math.pow(2,19);function h(t,e){let s=this.getChannelData(e);for(let e=0;e<t.length;e++)s[e]=t[e]}class u{constructor(t,e,s,i){if(this._fromSampleRate=t,this._toSampleRate=e,this._channels=0|s,"object"!=typeof i)throw new Error("inputBuffer is not an object.");if(!(i instanceof Array||i instanceof Float32Array||i instanceof Float64Array))throw new Error("inputBuffer is not an array or a float32 or a float64 array.");this._inputBuffer=i,this.initialize()}initialize(){if(!(this._fromSampleRate>0&&this._toSampleRate>0&&this._channels>0))throw new Error("Invalid settings specified for the resampler.");this._fromSampleRate==this._toSampleRate?(this._resampler=this.bypassResampler,this._ratioWeight=1,this._outputBuffer=this._inputBuffer):(this._ratioWeight=this._fromSampleRate/this._toSampleRate,this._fromSampleRate<this._toSampleRate?(this.compileLinearInterpolationFunction(),this._lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this._lastWeight=0),this.initializeBuffers())}initializeBuffers(){var t=Math.ceil(this._inputBuffer.length*this._toSampleRate/this._fromSampleRate/this._channels*1.0000004768371582)*this._channels+this._channels;try{this._outputBuffer=new Float32Array(t),this._lastOutput=new Float32Array(this._channels)}catch(t){this._outputBuffer=new Float32Array([]),this._lastOutput=new Float32Array([])}}bypassResampler(t){return t}compileMultiTapFunction(){for(var t="var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = 0;",e=0;e<this._channels;++e)t+="var output"+e+" = 0;";for(t+="var actualPosition = 0;        var amountToNext = 0;        var alreadyProcessedTail = !this.tailExists;        this.tailExists = false;        var outputBuffer = this.outputBuffer;        var currentPosition = 0;        do {            if (alreadyProcessedTail) {                weight = "+this._ratioWeight+";",e=0;e<this._channels;++e)t+="output"+e+" = 0;";for(t+="}            else {                weight = this.lastWeight;",e=0;e<this._channels;++e)t+="output"+e+" = this.lastOutput["+e+"];";for(t+="alreadyProcessedTail = true;            }            while (weight > 0 && actualPosition < bufferLength) {                amountToNext = 1 + actualPosition - currentPosition;                if (weight >= amountToNext) {",e=0;e<this._channels;++e)t+="output"+e+" += buffer[actualPosition++] * amountToNext;";for(t+="currentPosition = actualPosition;                    weight -= amountToNext;                }                else {",e=0;e<this._channels;++e)t+="output"+e+" += buffer[actualPosition"+(e>0?" + "+e:"")+"] * weight;";for(t+="currentPosition += weight;                    weight = 0;                    break;                }            }            if (weight <= 0) {",e=0;e<this._channels;++e)t+="outputBuffer[outputOffset++] = output"+e+" / "+this._ratioWeight+";";for(t+="}            else {                this.lastWeight = weight;",e=0;e<this._channels;++e)t+="this.lastOutput["+e+"] = output"+e+";";t+="this.tailExists = true;                break;            }        } while (actualPosition < bufferLength);    }    return outputOffset;",this._resampler=Function("bufferLength",t)}compileLinearInterpolationFunction(){for(var t="var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = this.lastWeight;        var firstWeight = 0;        var secondWeight = 0;        var sourceOffset = 0;        var outputOffset = 0;        var outputBuffer = this.outputBuffer;        for (; weight < 1; weight += "+this._ratioWeight+") {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;",e=0;e<this._channels;++e)t+="outputBuffer[outputOffset++] = (this.lastOutput["+e+"] * firstWeight) + (buffer["+e+"] * secondWeight);";t+="}        weight -= 1;        for (bufferLength -= "+this._channels+", sourceOffset = Math.floor(weight) * "+this._channels+"; sourceOffset < bufferLength;) {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;";for(e=0;e<this._channels;++e)t+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(e>0?" + "+e:"")+"] * firstWeight) + (buffer[sourceOffset + "+(this._channels+e)+"] * secondWeight);";t+="weight += "+this._ratioWeight+";            sourceOffset = Math.floor(weight) * "+this._channels+";        }";for(e=0;e<this._channels;++e)t+="this.lastOutput["+e+"] = buffer[sourceOffset++];";t+="this.lastWeight = weight % 1;    }    return outputOffset;",this._resampler=Function("bufferLength",t)}get outputBuffer(){return this._outputBuffer}get resampler(){return this._resampler}}var d=function(t,e,s,i){return new(s||(s=Promise))((function(a,n){function o(t){try{l(i.next(t))}catch(t){n(t)}}function r(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}l((i=i.apply(t,e||[])).next())}))};var c=function(t,e,s,i){return new(s||(s=Promise))((function(a,n){function o(t){try{l(i.next(t))}catch(t){n(t)}}function r(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}l((i=i.apply(t,e||[])).next())}))};var p=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},f=(t,e,s)=>(p(t,e,"read from private field"),s?s.call(t):e.get(t)),m=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},g=(t,e,s,i)=>(p(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),y=(t,e,s)=>(p(t,e,"access private method"),s);function v(t,e,s){const i=[];for(let a=e;a<e+s;a++)i.push(t[a]);return i}const _=0,w=1;function b(t,e,s,i=w){const a=v(t,e,s);return i===_&&a.reverse(),a.reduce(((t,e)=>256*t+e),0)}function S(t,e,s){return t<=e?e:t>=s?s:t}function k(t){return t>=32768?t-65536:t}var x,R,C,L,M,B,A,D,E,T,P,W,O,z,F,N,I,U,q,G;class j{constructor(t){if(m(this,P),m(this,O),m(this,F),m(this,I),m(this,q),m(this,x,void 0),m(this,R,void 0),m(this,C,void 0),m(this,L,void 0),m(this,M,void 0),m(this,B,void 0),m(this,A,void 0),m(this,D,void 0),m(this,E,void 0),m(this,T,void 0),g(this,A,null),g(this,D,null),g(this,E,null),g(this,T,[]),this.rawData=new Uint8Array(t),"RSTM"!==function(t,e,s,i=w){const a=v(t,e,s);return i===_&&a.reverse(),String.fromCharCode(...a)}(this.rawData,0,4))throw new Error("Not a valid BRSTM file");this.endianness=function(t){const e=v(t,4,2);return 255===e[0]&&254===e[1]?_:w}(this.rawData),g(this,x,b(this.rawData,16,4,this.endianness)),g(this,R,f(this,x)+b(this.rawData,f(this,x)+12,4,this.endianness)+8),g(this,C,f(this,x)+b(this.rawData,f(this,x)+20,4,this.endianness)+8),g(this,L,f(this,x)+b(this.rawData,f(this,x)+28,4,this.endianness)+8),g(this,M,b(this.rawData,24,4,this.endianness)),g(this,B,b(this.rawData,32,4,this.endianness)),this.metadata=y(this,O,z).call(this)}getAllSamples(){if(f(this,A))return f(this,A);const{numberChannels:t,totalSamples:e,totalBlocks:s,samplesPerBlock:i}=this.metadata,a=[];for(let s=0;s<t;s++)a.push(new Int16Array(e));for(let e=0;e<s;e++){const s=y(this,q,G).call(this,e);for(let n=0;n<t;n++)a[n].set(s[n],e*i)}return g(this,A,a),a}getBuffer(t,e){return this.getSamples(t,e)}getSamples(t,e){const{numberChannels:s,totalBlocks:i,totalSamples:a,samplesPerBlock:n}=this.metadata,o=Math.max(0,t),r=Math.min(a,t+e),l=Math.max(0,Math.floor(o/n)),h=Math.min(i-1,Math.floor(r/n)),u=[];for(let t=l;t<=h;t++)u.push(y(this,q,G).call(this,t));const d=[];for(let t=0;t<s;t++)d.push(new Int16Array(r-o));for(let t=l;t<=h;t++){const i=t-l;if(t===l&&t===h)for(let t=0;t<s;t++)d[t].set(u[i][t].slice(o-l*n,o-l*n+e),0);else if(t===l)for(let t=0;t<s;t++){const e=u[i][t].slice(o-l*n);d[t].set(e,0)}else if(t===h)for(let a=0;a<s;a++){const s=u[i][a].slice(0,r-u[i][a].length-l*n);s.length+(t*n-o)>d[a].length?d[a].set(s.slice(0,e-(t*n-o)),t*n-o):d[a].set(s,t*n-o)}else for(let e=0;e<s;e++)d[e].set(u[i][e],t*n-o)}return d}}x=new WeakMap,R=new WeakMap,C=new WeakMap,L=new WeakMap,M=new WeakMap,B=new WeakMap,A=new WeakMap,D=new WeakMap,E=new WeakMap,T=new WeakMap,P=new WeakSet,W=function(){if(f(this,E))return f(this,E);const{numberChannels:t}=this.metadata,e=[];for(let s=0;s<t;s++){const t=f(this,x)+b(this.rawData,f(this,L)+8+8*s,4,this.endianness)+8+8,i=[];for(let e=0;e<16;e++){const s=b(this.rawData,t+2*e,2,this.endianness);i.push(k(s))}e.push({adpcmCoefficients:i,gain:b(this.rawData,t+40,2,this.endianness),initialPredictorScale:b(this.rawData,t+42,2,this.endianness),historySample1:b(this.rawData,t+44,2,this.endianness),historySample2:b(this.rawData,t+46,2,this.endianness),loopPredictorScale:b(this.rawData,t+48,2,this.endianness),loopHistorySample1:b(this.rawData,t+50,2,this.endianness),loopHistorySample2:b(this.rawData,t+52,2,this.endianness)})}return g(this,E,e),e},O=new WeakSet,z=function(){const t=b(this.rawData,f(this,R)+2,1,this.endianness),e=b(this.rawData,f(this,C),1,this.endianness),s=b(this.rawData,f(this,C)+1,1,this.endianness),i=[];for(let t=0;t<e;t++){const e=f(this,x)+8+b(this.rawData,f(this,C)+4+8*t+4,4,this.endianness),s=b(this.rawData,f(this,C)+4+8*t+1,1,this.endianness);let a=0;0===s?a=b(this.rawData,e,1,this.endianness):1===s&&(a=b(this.rawData,e+8,1,this.endianness)),i.push({numberChannels:a,type:s})}const a={fileSize:b(this.rawData,8,4,this.endianness),endianness:this.endianness,codec:b(this.rawData,f(this,R),1,this.endianness),loopFlag:b(this.rawData,f(this,R)+1,1,this.endianness),numberChannels:t,sampleRate:b(this.rawData,f(this,R)+4,2,this.endianness),loopStartSample:b(this.rawData,f(this,R)+8,4,this.endianness),totalSamples:b(this.rawData,f(this,R)+12,4,this.endianness),totalBlocks:b(this.rawData,f(this,R)+20,4,this.endianness),blockSize:b(this.rawData,f(this,R)+24,4,this.endianness),samplesPerBlock:b(this.rawData,f(this,R)+28,4,this.endianness),finalBlockSize:b(this.rawData,f(this,R)+32,4,this.endianness),finalBlockSizeWithPadding:b(this.rawData,f(this,R)+40,4,this.endianness),totalSamplesInFinalBlock:b(this.rawData,f(this,R)+36,4,this.endianness),adpcTableSamplesPerEntry:b(this.rawData,f(this,R)+44,4,this.endianness),adpcTableBytesPerEntry:b(this.rawData,f(this,R)+48,4,this.endianness),numberTracks:e,trackDescriptionType:s,trackDescriptions:i};return a.loopStartSample>=a.totalSamples&&(a.loopFlag=0,a.loopStartSample=0,console.warn("The loop start sample in this file is invalid.")),a},F=new WeakSet,N=function(t){const{blockSize:e,totalBlocks:s,numberChannels:i,finalBlockSize:a,finalBlockSizeWithPadding:n}=this.metadata,o=[];for(let n=0;n<i;n++)o.push(new Uint8Array(t===s-1?a:e));let r=t;for(let t=0;t<i;t++){const l=0!==t&&r+1===s?r*i*e+t*n:(r*i+t)*e,h=r+1===s?l+a:l+e,u=this.rawData.slice(f(this,B)+32+l,f(this,B)+32+h);o[t].set(u)}return o},I=new WeakSet,U=function(){if(f(this,D))return f(this,D);const{totalBlocks:t,numberChannels:e}=this.metadata,s=b(this.rawData,f(this,M)+4,4,this.endianness),i=this.rawData.slice(f(this,M)+8,f(this,M)+8+s);let a=0,n=0,o=0;for(let t=0;t<e;t++)n=k(b(i,a,2,this.endianness)),a+=2,o=k(b(i,a,2,this.endianness)),a+=2;const r=[];for(let s=0;s<t;s++){r.push([]);for(let t=0;t<e;t++)s>0&&(n=k(b(i,a,2,this.endianness)),a+=2,o=k(b(i,a,2,this.endianness)),a+=2),r[s].push({yn1:n,yn2:o})}let l=[];for(let t=0;t<e;t++)l.push(r.map((e=>e[t])));return g(this,D,l),l},q=new WeakSet,G=function(t){if(f(this,T)[t])return f(this,T)[t];const{numberChannels:e,totalBlocks:s,totalSamplesInFinalBlock:i,samplesPerBlock:a,codec:n}=this.metadata,o=y(this,P,W).call(this),r=y(this,F,N).call(this,t),l=y(this,I,U).call(this),h=[],u=t===s-1?i:a;for(let t=0;t<e;t++)h.push(new Int16Array(u));for(let i=0;i<e;i++){const{adpcmCoefficients:e}=o[i],a=r[i],d=[];if(2===n){const n=a[0],{yn1:o,yn2:r}=l[i][t];let h=n,c=o,p=r,f=0;for(let t=0;t<u;){let s=0;t%14==0&&(h=a[f++]),s=0==(1&t++)?a[f]>>4:15&a[f++],s>=8&&(s-=16);const i=h>>4<<1;s=1024+((1<<(15&h))*s<<11)+e[S(i,0,15)]*c+e[S(i+1,0,15)]*p>>11,p=c,c=S(s,-32768,32767),d.push(c)}t<s-1&&(l[i][t+1].yn1=d[u-1],l[i][t+1].yn2=d[u-2])}else if(1===n)for(let t=0;t<u;t++){const e=k(b(a,2*t,2,this.endianness));d.push(e)}else{if(0!==n)throw new Error("Invalid codec");for(let t=0;t<u;t++)d.push(256*k(a[t]))}h[i].set(d)}return f(this,T)[t]=h,h};var H=function(t,e,s,i){return new(s||(s=Promise))((function(a,n){function o(t){try{l(i.next(t))}catch(t){n(t)}}function r(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}l((i=i.apply(t,e||[])).next())}))};function V(t,e,s){let i=[],a=0;for(let e=0;e<t.metadata.numberChannels;e++)i.push(new Int16Array(s));for(;a<s;){let n=t.getSamples(e+a,Math.min(t.metadata.samplesPerBlock,s-a));for(let t=0;t<n.length;t++)i[t].set(n[t],a);a+=Math.min(t.metadata.samplesPerBlock,s-a)}return i}let X=new class{constructor(t="https://smashcustommusic.net"){this._state={hasInitialized:!1,capabilities:null,audioContext:null,scriptNode:null,gainNode:null,fullyLoaded:!0,loadState:0,playbackCurrentSample:0,brstm:null,brstmBuffer:null,paused:!1,stopped:!1,enableLoop:!1,streamCancel:!1,playAudioRunning:!1,volume:Number(localStorage.getItem("volumeoverride"))||1,samplesReady:0},this._apiURL=t,this._audio=document.createElement("audio"),this._audio.src="https://github.com/anars/blank-audio/blob/master/5-seconds-of-silence.mp3?raw=true",this._audio.loop=!0}getBrstmUrl(t){return this._apiURL+"/brstm/"+t}getSongUrl(t){return this._apiURL+"/json/song/"+t}guiupd(){r.updateState({position:this._state.playbackCurrentSample,paused:this._state.paused,volume:this._state.volume,loaded:this._state.samplesReady,looping:this._state.enableLoop})}getResampledSample(t,e,s){return Math.ceil(s/t*e)}loadSongLegacy(t){return H(this,void 0,void 0,(function*(){let e=yield fetch(t),s=yield e.arrayBuffer();this._state.brstm=new j(s),this._state.fullyLoaded=!0,this._state.loadState=Number.MAX_SAFE_INTEGER,this._state.samplesReady=Number.MAX_SAFE_INTEGER}))}loadSongStreaming(t){return new Promise(((e,s)=>H(this,void 0,void 0,(function*(){let i,a;try{i=yield fetch(t),a=(yield i.body).getReader()}catch(t){return s(t)}this._state.brstmBuffer=new ArrayBuffer(parseInt(i.headers.get("content-length")));let n=new Uint8Array(this._state.brstmBuffer),o=0,h=!1,u=0;for(this._state.samplesReady=0,this._state.fullyLoaded=!1,this._state.streamCancel=!1;;){let t;try{t=yield a.read()}catch(t){return void(h?(r.updateState({streamingDied:!0,buffering:!1,ready:!0}),yield this._state.audioContext.close(),this._state.audioContext=null):s(t))}if(this._state.streamCancel)return yield a.cancel(),void window.postMessage("continueload");if(t.done){if(!h)try{this._state.brstm=new j(this._state.brstmBuffer),e(),h=!0}catch(t){return void s(t)}this._state.fullyLoaded=!0,this._state.samplesReady=Number.MAX_SAFE_INTEGER,console.log("File finished streaming");break}if(n.set(t.value,o),o+=t.value.length,this._state.loadState=o,0==u&&o>128){let t=0;65279==256*n[4]+n[5]&&(t=1),u=1==t?16777216*n[112]+65536*n[113]+256*n[114]+n[115]:n[112]+256*n[113]+65536*n[114]+16777216*n[115],u<144&&(u=l)}if(!h&&0!=u&&o>u)try{this._state.brstm=new j(this._state.brstmBuffer),e(),h=!0}catch(t){return void s(t)}h&&(this._state.samplesReady=Math.floor((this._state.loadState-u)/this._state.brstm.metadata.numberChannels/this._state.brstm.metadata.blockSize)*this._state.brstm.metadata.samplesPerBlock)}}))))}setVolume(t){this._state.volume=t,this.guiupd(),this._state.gainNode&&this._state.gainNode.gain.setValueAtTime(this._state.volume,this._state.audioContext.currentTime)}incVolume(t){this.setVolume(Math.min(this._state.volume+t,1))}decVolume(t){this.setVolume(Math.max(this._state.volume-t,0))}seek(t){this._state.playbackCurrentSample=Math.floor(t),this.guiupd()}next(){}previous(){}playPause(){this._state.paused=!this._state.paused,this._state.audioContext[this._state.paused?"suspend":"resume"](),this._state.capabilities.mediaSession&&(navigator.mediaSession.playbackState="playing"===navigator.mediaSession.playbackState?"paused":"playing"),this.guiupd()}setLoop(t){this._state.enableLoop=t,this.guiupd()}stop(){this._state.stopped=!0,r.destroyGui()}fetchSongDetails(t){return H(this,void 0,void 0,(function*(){let e=yield fetch(this.getSongUrl(t));e.status>=400?console.error(`could not fetch song details for id ${t}.`):this._song=yield e.json()}))}play(t){return H(this,void 0,void 0,(function*(){let e=this.getBrstmUrl(t);if(this._state.capabilities=yield function(){return c(this,void 0,void 0,(function*(){let t={sampleRate:!1,streaming:!1,mediaSession:!1};try{let e=new(window.AudioContext||AudioContext)({sampleRate:8e3});t.sampleRate=8e3===e.sampleRate,e.close()}catch(t){console.log("WebAudio sample rate capability detection failed. Assuming fallback.")}try{let e=new Uint8Array(Math.pow(2,16)),s=new Blob([e],{type:"application/octet-stream"}),i=URL.createObjectURL(s),a=yield fetch(i);const n=(yield a.body).getReader();for(;!(yield n.read()).done;);t.streaming=!0}catch(t){console.log("Streaming capability detection failed. Assuming fallback.")}t.mediaSession="mediaSession"in navigator;var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),s=!!e&&parseInt(e[2],10);return!1!==s&&s>=89&&(t.sampleRate=!1),t}))}(),this.fetchSongDetails(t).then((t=>{this._setMediaSessionData(),this._state.capabilities.mediaSession&&(navigator.mediaSession.playbackState="playing")})),this._state.stopped=!1,r.runGUI(this),console.log(`Playing ${e}`),this._state.hasInitialized||setInterval((()=>{r.updateState({loaded:this._state.samplesReady}),r.guiUpdate()}),100),this._state.playAudioRunning)return;var s,i;this._state.playAudioRunning=!0,this._state.fullyLoaded||(console.log("Cancelling last stream..."),this._state.streamCancel=!0,yield(s="continueload",new Promise((t=>{let e=i=>{i.data===s&&i.isTrusted&&(window.removeEventListener("message",e),t())};window.addEventListener("message",e)}))),console.log("Done.")),this._state.audioContext&&(yield this._state.audioContext.close(),this._state.audioContext=null),this._state.playbackCurrentSample=0,this._state.paused=!1,r.updateState({ready:!1,position:0,samples:1e6,loaded:0,volume:this._state.volume,paused:!1,buffering:!1,sampleRate:44100,streamingDied:!1});try{yield(this._state.capabilities.streaming?this.loadSongStreaming.bind(this):this.loadSongLegacy.bind(this))(e)}catch(t){return r.updateState({streamingDied:!0,ready:!0,buffering:!1}),console.error(t),void(this._state.playAudioRunning=!1)}this._state.audioContext=new window.AudioContext(this._state.capabilities.sampleRate?{sampleRate:this._state.brstm.metadata.sampleRate}:{}),this._state.enableLoop=1===this._state.brstm.metadata.loopFlag,yield function(t){return new Promise((e=>d(this,void 0,void 0,(function*(){let s=!1,i=document.createElement("div");i.setAttribute("style","background: #888a; z-index: 88888; position: fixed; top: 0; bottom: 0; left: 0; right: 0; display: flex; align-items: center; justify-content: center;");let a=document.createElement("div");a.setAttribute("style","display: flex; align-items: center; justify-content: center; flex-direction: column"),a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" version="1.0"  width="200" height="200" viewBox="0 0 75 75">\n<path d="M39.389,13.769 L22.235,28.606 L6,28.606 L6,47.699 L21.989,47.699 L39.389,62.75 L39.389,13.769z"\nstyle="stroke:#fff;stroke-width:5;stroke-linejoin:round;fill:#fff;"\n/>\n<path d="M48,27.6a19.5,19.5 0 0 1 0,21.4M55.1,20.5a30,30 0 0 1 0,35.6M61.6,14a38.8,38.8 0 0 1 0,48.6" style="fill:none;stroke:#fff;stroke-width:5;stroke-linecap:round"/>\n</svg><h1 style="font-family: sans-serif; color: white; margin: 0;">Tap or click anywhere to enable audio.</h1>',i.appendChild(a),setTimeout((function(){s||document.body.appendChild(i)}),200),t.onstatechange=function(){"running"==t.state&&(e(),i.remove(),s=!0)};try{t.resume()}catch(t){console.error(t)}i.addEventListener("touchend",(function(){return d(this,void 0,void 0,(function*(){yield t.resume(),"running"===t.state&&(e(),i.remove(),s=!0)}))})),i.addEventListener("click",(function(){return d(this,void 0,void 0,(function*(){yield t.resume(),"running"===t.state&&(e(),i.remove(),s=!0)}))})),"running"===t.state&&(e(),i.remove(),s=!0)}))))}(this._state.audioContext),this._state.capabilities.streaming&&(yield(i=1e3,new Promise((t=>setTimeout(t,i))))),this._state.scriptNode=this._state.audioContext.createScriptProcessor(0,0,2);let a=this._state.scriptNode.bufferSize;a=this._state.capabilities.sampleRate?a:this.getResampledSample(this._state.audioContext.sampleRate,this._state.brstm.metadata.sampleRate,a);let n=a;this._state.capabilities.sampleRate||(n+=20),r.updateState({ready:!0,samples:this._state.brstm.metadata.totalSamples}),r.updateState({sampleRate:this._state.brstm.metadata.sampleRate}),this._state.playAudioRunning=!1,this._state.scriptNode.onaudioprocess=t=>{if(!0===this._state.stopped)return;this.guiupd();let e,s=t.outputBuffer;if(s.copyToChannel||(s.copyToChannel=h),this._state.playbackCurrentSample+a+1024>this._state.samplesReady)return r.updateState({buffering:!0}),console.log("Buffering...."),s.copyToChannel(new Float32Array(this._state.scriptNode.bufferSize).fill(0),0),void s.copyToChannel(new Float32Array(this._state.scriptNode.bufferSize).fill(0),1);if(r.updateState({buffering:!1}),this._state.paused)return s.copyToChannel(new Float32Array(this._state.scriptNode.bufferSize).fill(0),0),void s.copyToChannel(new Float32Array(this._state.scriptNode.bufferSize).fill(0),1);if(this._state.playbackCurrentSample+n<this._state.brstm.metadata.totalSamples)e=V(this._state.brstm,this._state.playbackCurrentSample,n),this._state.playbackCurrentSample+=a;else if(this._state.enableLoop){e=V(this._state.brstm,this._state.playbackCurrentSample,this._state.brstm.metadata.totalSamples-this._state.playbackCurrentSample);let t=e[0].length;console.log(this._state.brstm.metadata.totalSamples-this._state.playbackCurrentSample,n-t);let s=V(this._state.brstm,this._state.brstm.metadata.loopStartSample,n-t);for(let t=0;t<e.length;t++){let i=new Int16Array(n).fill(0);i.set(e[t]),i.set(s[t],e[t].length),e[t]=i}this._state.playbackCurrentSample=this._state.brstm.metadata.loopStartSample+a-t}else{e=V(this._state.brstm,this._state.playbackCurrentSample,this._state.brstm.metadata.totalSamples-this._state.playbackCurrentSample-1);for(let t=0;t<e.length;t++){let s=new Int16Array(n).fill(0);s.set(e[t]),e[t]=s}this._state.playbackCurrentSample=0,this._state.paused=!0,setTimeout((()=>{this._state.audioContext.suspend()}),200)}e.length>2&&(e=[e[0],e[1]]),1===e.length&&(e=[e[0],e[0]]);for(let t=0;t<e.length;t++){let i=new Float32Array(n);for(let s=0;s<n;s++)i[s]=e[t][s]/32768;if(!this._state.capabilities.sampleRate){let t=new u(this._state.brstm.metadata.sampleRate,this._state.audioContext.sampleRate,1,i);t.resampler(n),i=new Float32Array(t.outputBuffer),i.length>this._state.scriptNode.bufferSize&&(i=i.slice(0,this._state.scriptNode.bufferSize))}s.copyToChannel(i,t)}},this._state.gainNode=this._state.audioContext.createGain(),this._state.scriptNode.connect(this._state.gainNode),this._state.gainNode.connect(this._state.audioContext.destination),this._state.gainNode.gain.setValueAtTime(this._state.volume,this._state.audioContext.currentTime)}))}_setMediaSessionData(){return H(this,void 0,void 0,(function*(){this._state.capabilities.mediaSession&&this._audio.play().then((t=>{navigator.mediaSession.metadata=new MediaMetadata({title:this._song.name,album:this._song.game_name,artist:this._song.uploader,artwork:[{src:"https://ssb.wiki.gallery/images/a/a2/SSBU_spirit_Smash_Ball.png",type:"image/png",sizes:"560x544"}]}),navigator.mediaSession.setActionHandler("play",(()=>{this.playPause()})),navigator.mediaSession.setActionHandler("pause",(()=>{this.playPause()})),navigator.mediaSession.setActionHandler("stop",(()=>{this.stop()})),navigator.mediaSession.setActionHandler("nexttrack",(()=>this.next)),navigator.mediaSession.setActionHandler("previoustrack",(()=>this.previous))})).catch((t=>{console.error(t)}))}))}}("https://smashcustommusic.net");window.player=X}();
