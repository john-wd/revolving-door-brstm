!function(){"use strict";function t(t){var e={exports:{}};return t(e,e.exports),e.exports}var e=t((function(t,e){var a=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},n=(t,e,n)=>(a(t,e,"read from private field"),n?n.call(t):e.get(t)),i=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},s=(t,e,n,i)=>(a(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),o=(t,e,n)=>(a(t,e,"access private method"),n);function l(t,e,a){const n=[];for(let i=e;i<e+a;i++)n.push(t[i]);return n}Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=0,h=1;function u(t,e,a,n=h){const i=l(t,e,a);return n===r&&i.reverse(),i.reduce(((t,e)=>256*t+e),0)}function c(t,e,a){return t<=e?e:t>=a?a:t}function d(t){return t>=32768?t-65536:t}var f,p,m,g,w,y,v,S,b,k,M,R,B,D,x,T,E,W,A,C;f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,w=new WeakMap,y=new WeakMap,v=new WeakMap,S=new WeakMap,b=new WeakMap,k=new WeakMap,M=new WeakSet,R=function(){if(n(this,b))return n(this,b);const{numberChannels:t}=this.metadata,e=[];for(let a=0;a<t;a++){const t=n(this,f)+u(this.rawData,n(this,g)+8+8*a,4,this.endianness)+8+8,i=[];for(let e=0;e<16;e++){const a=u(this.rawData,t+2*e,2,this.endianness);i.push(d(a))}e.push({adpcmCoefficients:i,gain:u(this.rawData,t+40,2,this.endianness),initialPredictorScale:u(this.rawData,t+42,2,this.endianness),historySample1:u(this.rawData,t+44,2,this.endianness),historySample2:u(this.rawData,t+46,2,this.endianness),loopPredictorScale:u(this.rawData,t+48,2,this.endianness),loopHistorySample1:u(this.rawData,t+50,2,this.endianness),loopHistorySample2:u(this.rawData,t+52,2,this.endianness)})}return s(this,b,e),e},B=new WeakSet,D=function(){const t=u(this.rawData,n(this,p)+2,1,this.endianness),e=u(this.rawData,n(this,m),1,this.endianness),a=u(this.rawData,n(this,m)+1,1,this.endianness),i=[];for(let t=0;t<e;t++){const e=n(this,f)+8+u(this.rawData,n(this,m)+4+8*t+4,4,this.endianness),a=u(this.rawData,n(this,m)+4+8*t+1,1,this.endianness);let s=0;0===a?s=u(this.rawData,e,1,this.endianness):1===a&&(s=u(this.rawData,e+8,1,this.endianness)),i.push({numberChannels:s,type:a})}const s={fileSize:u(this.rawData,8,4,this.endianness),endianness:this.endianness,codec:u(this.rawData,n(this,p),1,this.endianness),loopFlag:u(this.rawData,n(this,p)+1,1,this.endianness),numberChannels:t,sampleRate:u(this.rawData,n(this,p)+4,2,this.endianness),loopStartSample:u(this.rawData,n(this,p)+8,4,this.endianness),totalSamples:u(this.rawData,n(this,p)+12,4,this.endianness),totalBlocks:u(this.rawData,n(this,p)+20,4,this.endianness),blockSize:u(this.rawData,n(this,p)+24,4,this.endianness),samplesPerBlock:u(this.rawData,n(this,p)+28,4,this.endianness),finalBlockSize:u(this.rawData,n(this,p)+32,4,this.endianness),finalBlockSizeWithPadding:u(this.rawData,n(this,p)+40,4,this.endianness),totalSamplesInFinalBlock:u(this.rawData,n(this,p)+36,4,this.endianness),adpcTableSamplesPerEntry:u(this.rawData,n(this,p)+44,4,this.endianness),adpcTableBytesPerEntry:u(this.rawData,n(this,p)+48,4,this.endianness),numberTracks:e,trackDescriptionType:a,trackDescriptions:i};return s.loopStartSample>=s.totalSamples&&(s.loopFlag=0,s.loopStartSample=0,console.warn("The loop start sample in this file is invalid.")),s},x=new WeakSet,T=function(t){const{blockSize:e,totalBlocks:a,numberChannels:i,finalBlockSize:s,finalBlockSizeWithPadding:o}=this.metadata,l=[];for(let n=0;n<i;n++)l.push(new Uint8Array(t===a-1?s:e));let r=t;for(let t=0;t<i;t++){const h=0!==t&&r+1===a?r*i*e+t*o:(r*i+t)*e,u=r+1===a?h+s:h+e,c=this.rawData.slice(n(this,y)+32+h,n(this,y)+32+u);l[t].set(c)}return l},E=new WeakSet,W=function(){if(n(this,S))return n(this,S);const{totalBlocks:t,numberChannels:e}=this.metadata,a=u(this.rawData,n(this,w)+4,4,this.endianness),i=this.rawData.slice(n(this,w)+8,n(this,w)+8+a);let o=0,l=0,r=0;for(let t=0;t<e;t++)l=d(u(i,o,2,this.endianness)),o+=2,r=d(u(i,o,2,this.endianness)),o+=2;const h=[];for(let a=0;a<t;a++){h.push([]);for(let t=0;t<e;t++)a>0&&(l=d(u(i,o,2,this.endianness)),o+=2,r=d(u(i,o,2,this.endianness)),o+=2),h[a].push({yn1:l,yn2:r})}let c=[];for(let t=0;t<e;t++)c.push(h.map((e=>e[t])));return s(this,S,c),c},A=new WeakSet,C=function(t){if(n(this,k)[t])return n(this,k)[t];const{numberChannels:e,totalBlocks:a,totalSamplesInFinalBlock:i,samplesPerBlock:s,codec:l}=this.metadata,r=o(this,M,R).call(this),h=o(this,x,T).call(this,t),f=o(this,E,W).call(this),p=[],m=t===a-1?i:s;for(let t=0;t<e;t++)p.push(new Int16Array(m));for(let n=0;n<e;n++){const{adpcmCoefficients:e}=r[n],i=h[n],s=[];if(2===l){const o=i[0],{yn1:l,yn2:r}=f[n][t];let h=o,u=l,d=r,p=0;for(let t=0;t<m;){let a=0;t%14==0&&(h=i[p++]),a=0==(1&t++)?i[p]>>4:15&i[p++],a>=8&&(a-=16);const n=h>>4<<1;a=1024+((1<<(15&h))*a<<11)+e[c(n,0,15)]*u+e[c(n+1,0,15)]*d>>11,d=u,u=c(a,-32768,32767),s.push(u)}t<a-1&&(f[n][t+1].yn1=s[m-1],f[n][t+1].yn2=s[m-2])}else if(1===l)for(let t=0;t<m;t++){const e=d(u(i,2*t,2,this.endianness));s.push(e)}else{if(0!==l)throw new Error("Invalid codec");for(let t=0;t<m;t++)s.push(256*d(i[t]))}p[n].set(s)}return n(this,k)[t]=p,p},e.Brstm=class{constructor(t){if(i(this,M),i(this,B),i(this,x),i(this,E),i(this,A),i(this,f,void 0),i(this,p,void 0),i(this,m,void 0),i(this,g,void 0),i(this,w,void 0),i(this,y,void 0),i(this,v,void 0),i(this,S,void 0),i(this,b,void 0),i(this,k,void 0),s(this,v,null),s(this,S,null),s(this,b,null),s(this,k,[]),this.rawData=new Uint8Array(t),"RSTM"!==function(t,e,a,n=h){const i=l(t,e,a);return n===r&&i.reverse(),String.fromCharCode(...i)}(this.rawData,0,4))throw new Error("Not a valid BRSTM file");this.endianness=function(t){const e=l(t,4,2);return 255===e[0]&&254===e[1]?r:h}(this.rawData),s(this,f,u(this.rawData,16,4,this.endianness)),s(this,p,n(this,f)+u(this.rawData,n(this,f)+12,4,this.endianness)+8),s(this,m,n(this,f)+u(this.rawData,n(this,f)+20,4,this.endianness)+8),s(this,g,n(this,f)+u(this.rawData,n(this,f)+28,4,this.endianness)+8),s(this,w,u(this.rawData,24,4,this.endianness)),s(this,y,u(this.rawData,32,4,this.endianness)),this.metadata=o(this,B,D).call(this)}getAllSamples(){if(n(this,v))return n(this,v);const{numberChannels:t,totalSamples:e,totalBlocks:a,samplesPerBlock:i}=this.metadata,l=[];for(let a=0;a<t;a++)l.push(new Int16Array(e));for(let e=0;e<a;e++){const a=o(this,A,C).call(this,e);for(let n=0;n<t;n++)l[n].set(a[n],e*i)}return s(this,v,l),l}getBuffer(t,e){return this.getSamples(t,e)}getSamples(t,e){const{numberChannels:a,totalBlocks:n,totalSamples:i,samplesPerBlock:s}=this.metadata,l=Math.max(0,t),r=Math.min(i,t+e),h=Math.max(0,Math.floor(l/s)),u=Math.min(n-1,Math.floor(r/s)),c=[];for(let t=h;t<=u;t++)c.push(o(this,A,C).call(this,t));const d=[];for(let t=0;t<a;t++)d.push(new Int16Array(r-l));for(let t=h;t<=u;t++){const n=t-h;if(t===h&&t===u)for(let t=0;t<a;t++)d[t].set(c[n][t].slice(l-h*s,l-h*s+e),0);else if(t===h)for(let t=0;t<a;t++){const e=c[n][t].slice(l-h*s);d[t].set(e,0)}else if(t===u)for(let i=0;i<a;i++){const a=c[n][i].slice(0,r-c[n][i].length-h*s);a.length+(t*s-l)>d[i].length?d[i].set(a.slice(0,e-(t*s-l)),t*s-l):d[i].set(a,t*s-l)}else for(let e=0;e<a;e++)d[e].set(c[n][e],t*s-l)}return d}}})),a={STREAMING_MIN_RESPONSE:2**19},n=function(t,e){let a=this.getChannelData(e);for(let e=0;e<t.length;e++)a[e]=t[e]};let i=!1,s="",o=null,l=new Map,r=new Map;function h(t,e){let a=o.getBoundingClientRect(),n=t-a.x,i=e-a.y;return n<0&&(n=0),i<0&&(i=0),n>a.width&&(n=a.width),i>a.height&&(i=a.height),[n,i]}function u(t,e,a){if(l.has(t))for(let n=0;n<l.get(t).length;n++)l.get(t)[n](e,a)}var c=function(t,e){if(l.has(t)){let a=l.get(t);a.push(e),l.set(t,a)}else l.set(t,[e])},d=function(t,e){if(r.has(t)){let a=r.get(t);a.push(e),r.set(t,a)}else r.set(t,[e])},f=function(){document.addEventListener("mousedown",(function(t){if(t.target.dataset.gestureHitzone){i=!0,s=t.target.dataset.gestureHitzone,o=t.target;let[e,a]=h(t.clientX,t.clientY);u(s,e,a)}})),document.addEventListener("mousemove",(function(t){if(i){let[e,a]=h(t.clientX,t.clientY);u(s,e,a)}})),document.addEventListener("mouseup",(function(t){if(i){let[e,a]=h(t.clientX,t.clientY);!function(t,e,a){if(r.has(t))for(let n=0;n<r.get(t).length;n++)r.get(t)[n](e,a)}(s,e,a),i=!1,o=null,s=""}}))},p=t((function(t){let e={position:0,samples:1e6,loaded:5e5,volume:1,paused:!1,ready:!1,buffering:!1,sampleRate:48e3,looping:!1,streamingDied:!1},a={volume:null,position:null},n={},i=null,s=null,o=null,l=-30;function r(i){try{i.preventDefault()}catch(t){}if(i.targetTouches.length>0){let s=i.targetTouches[0].target.getBoundingClientRect(),o=i.targetTouches[0].clientY+i.targetTouches[0].radiusY-s.top;o<5&&(o=0),o>80&&(o=84);let l=1-o/84;a.volume=l,"touchend"===i.type&&(e.volume=a.volume,n.setVolume(a.volume),a.volume=null,localStorage.setItem("volumeoverride",l)),t.exports.guiUpdate()}else"touchend"===i.type&&(e.volume=a.volume,n.setVolume(a.volume),a.volume=null)}function h(i){try{i.preventDefault()}catch(t){}if(i.targetTouches.length>0){let s=i.targetTouches[0].target.getBoundingClientRect(),o=i.targetTouches[0].clientX+i.targetTouches[0].radiusX-s.left;if(o<5&&(o=0),o>254&&(o=254),o=Math.round(o),o===l)return;l=o;let r=e.samples*(o/254);r<e.loaded&&(a.position=r),"touchend"===i.type&&(n.seek(a.position),a.position=null),t.exports.guiUpdate()}else"touchend"===i.type&&(n.seek(a.position),a.position=null)}function u(n,i){let s=Math.round(n),o=e.samples*(s/254);o<e.loaded&&(a.position=o),t.exports.guiUpdate()}function p(i,s){let o=Math.round(i),l=e.samples*(o/254);l<e.loaded&&(a.position=l),n.seek(l),a.position=null,t.exports.guiUpdate()}function m(e,n){n=Math.round(n),a.volume=1-n/84,t.exports.guiUpdate()}function g(e,i){let s=1-(i=Math.round(i))/84;a.volume=null,localStorage.setItem("volumeoverride",s),n.setVolume(s),t.exports.guiUpdate()}t.exports.updateState=function(t){Object.assign(e,t)},t.exports.runGUI=function(a){n=a,o=document.createElement("div"),o.classList.add("guiholder"),o.innerHTML='\n<div class="error" style="display: none">\n    <h3>Playback failed!</h3>\n    <h3>Reload the page and try again.</h3>\n    <h3>If the issue continues, contact us.</h3>\n</div>\n<div id="gui-loading-bar">\n    <div id="gui-inner-loading-bar"></div>\n</div>\n<div class="guistate" data-guistate="preload">\n    <h3>Loading song...</h3>\n</div>\n<div class="guistate" data-guistate="ready">\n    <div id="pl-pause-play">\n        <svg width="48" height="48" viewBox="0 0 48 48" id="pl-play">\n            <path d="M 10, 10 l 0, 28 l 28, -14" fill="white"></path>\n        </svg>\n        <svg width="48" height="48" viewBox="0 0 48 48" id="pl-pause" style="display: none;">\n            <path d="M 10, 10 l 0, 28 l 10, 0 l 0, -28 M 28, 10 l 0, 28 l 10, 0 l 0, -28" fill="white"></path>\n        </svg>\n    </div>\n    <canvas id="pl-volume" width="16" height="84" data-gesture-hitzone="volume"></canvas>\n    <div id="pl-timing">\n        <span id="pl-time-start">0:00</span>\n        <span id="pl-time-end"  >0:00</span>\n    </div>\n    <canvas id="pl-seek" width="254" height="16" data-gesture-hitzone="seek"></canvas>\n    <div id="pl-loop">\n        <input type="checkbox" id="pl-loop-box" style="width: 16px; height: 16px; margin: 0;">\n        <span class="pl-loop-text">Enable loop</span>\n        <a class="pl-loop-text" target="_blank" href="https://smashcustommusic.net/feedback/">Send feedback</a>\n        <a class="pl-loop-text" target="_blank" href="https://github.com/rphsoftware/revolving-door">v2 by Rph</a>\n    </div>\n</div>',document.body.appendChild(o),i=document.querySelector("#pl-volume").getContext("2d"),s=document.querySelector("#pl-seek").getContext("2d"),document.querySelector("#pl-volume").addEventListener("touchstart",r),document.querySelector("#pl-volume").addEventListener("touchmove",r),document.querySelector("#pl-volume").addEventListener("touchend",r),document.querySelector("#pl-seek").addEventListener("touchstart",h),document.querySelector("#pl-seek").addEventListener("touchmove",h),document.querySelector("#pl-seek").addEventListener("touchend",h),document.querySelector("#pl-pause-play").addEventListener("click",(function(){n.pause(),t.exports.guiUpdate()})),document.querySelector("#pl-loop-box").addEventListener("input",(function(){e.looping=document.querySelector("#pl-loop-box").checked,n.setLoop(e.looping)})),o.addEventListener("drag",(function(t){t.preventDefault()})),f(),c("seek",u),d("seek",p),c("volume",m),d("volume",g)};let w=null,y=null,v=-1,S=-1,b=null,k=-1,M=-1,R=null,B=-1,D=null;t.exports.guiUpdate=function(){if(o){D!==e.streamingDied&&(o.querySelector(".error").style.display=e.streamingDied?"flex":"none",D=e.streamingDied);let t=e.buffering||!e.ready;if(w!==t&&(o.querySelector("#gui-loading-bar").dataset.exists=t,w=t),y!==e.ready&&(o.querySelector('.guistate[data-guistate="preload"]').style.display=e.ready?"none":"block",o.querySelector('.guistate[data-guistate="ready"]').style.display=e.ready?"grid":"none",y=e.ready),!e.ready)return;let n=Math.round(84-84*e.volume);null!==a.volume&&(n=Math.round(84-84*a.volume)),n!==v&&(i.fillStyle="#444",i.fillRect(0,0,16,84),i.fillStyle="hsl(200, 85%, 55%)",i.fillRect(0,n,16,84),v=n);let l=Math.ceil(e.position/e.samples*254);null!==a.position&&(l=Math.ceil(a.position/e.samples*254));let r=Math.ceil(e.loaded/e.samples*254);l===S&&r===B||(s.fillStyle="#222",s.fillRect(0,0,254,16),s.fillStyle="#666",s.fillRect(0,0,Math.min(254,r),16),s.fillStyle="hsl(200, 85%, 55%)",s.fillRect(0,0,Math.min(254,l),16),S=l,B=r),b!==e.paused&&(o.querySelector("#pl-pause").style.display=e.paused?"none":"block",o.querySelector("#pl-play").style.display=e.paused?"block":"none",b=e.paused);let h=Math.floor(e.samples/e.sampleRate),u=Math.floor(e.position/e.sampleRate);null!==a.position&&(u=Math.floor(a.position/e.sampleRate)),h!==k&&(o.querySelector("#pl-time-end").innerText=`${Math.floor(h/60)}:${(h%60).toString().padStart(2,"0")}`,k=h),u!==M&&(o.querySelector("#pl-time-start").innerText=`${Math.floor(u/60)}:${(u%60).toString().padStart(2,"0")}`,M=u),R!==e.looping&&(o.querySelector("#pl-loop-box").checked=e.looping,R=e.looping)}}})),m=e;function g(t,e,a,n){if(this.fromSampleRate=+t,this.toSampleRate=+e,this.channels=0|a,"object"!=typeof n)throw new Error("inputBuffer is not an object.");if(!(n instanceof Array||n instanceof Float32Array||n instanceof Float64Array))throw new Error("inputBuffer is not an array or a float32 or a float64 array.");this.inputBuffer=n,this.initialize()}g.prototype.initialize=function(){if(!(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0))throw new Error("Invalid settings specified for the resampler.");this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1,this.outputBuffer=this.inputBuffer):(this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.initializeBuffers())},g.prototype.compileLinearInterpolationFunction=function(){for(var t="var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = this.lastWeight;        var firstWeight = 0;        var secondWeight = 0;        var sourceOffset = 0;        var outputOffset = 0;        var outputBuffer = this.outputBuffer;        for (; weight < 1; weight += "+this.ratioWeight+") {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;",e=0;e<this.channels;++e)t+="outputBuffer[outputOffset++] = (this.lastOutput["+e+"] * firstWeight) + (buffer["+e+"] * secondWeight);";t+="}        weight -= 1;        for (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; sourceOffset < bufferLength;) {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;";for(e=0;e<this.channels;++e)t+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(e>0?" + "+e:"")+"] * firstWeight) + (buffer[sourceOffset + "+(this.channels+e)+"] * secondWeight);";t+="weight += "+this.ratioWeight+";            sourceOffset = Math.floor(weight) * "+this.channels+";        }";for(e=0;e<this.channels;++e)t+="this.lastOutput["+e+"] = buffer[sourceOffset++];";t+="this.lastWeight = weight % 1;    }    return outputOffset;",this.resampler=Function("bufferLength",t)},g.prototype.compileMultiTapFunction=function(){for(var t="var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = 0;",e=0;e<this.channels;++e)t+="var output"+e+" = 0;";for(t+="var actualPosition = 0;        var amountToNext = 0;        var alreadyProcessedTail = !this.tailExists;        this.tailExists = false;        var outputBuffer = this.outputBuffer;        var currentPosition = 0;        do {            if (alreadyProcessedTail) {                weight = "+this.ratioWeight+";",e=0;e<this.channels;++e)t+="output"+e+" = 0;";for(t+="}            else {                weight = this.lastWeight;",e=0;e<this.channels;++e)t+="output"+e+" = this.lastOutput["+e+"];";for(t+="alreadyProcessedTail = true;            }            while (weight > 0 && actualPosition < bufferLength) {                amountToNext = 1 + actualPosition - currentPosition;                if (weight >= amountToNext) {",e=0;e<this.channels;++e)t+="output"+e+" += buffer[actualPosition++] * amountToNext;";for(t+="currentPosition = actualPosition;                    weight -= amountToNext;                }                else {",e=0;e<this.channels;++e)t+="output"+e+" += buffer[actualPosition"+(e>0?" + "+e:"")+"] * weight;";for(t+="currentPosition += weight;                    weight = 0;                    break;                }            }            if (weight <= 0) {",e=0;e<this.channels;++e)t+="outputBuffer[outputOffset++] = output"+e+" / "+this.ratioWeight+";";for(t+="}            else {                this.lastWeight = weight;",e=0;e<this.channels;++e)t+="this.lastOutput["+e+"] = output"+e+";";t+="this.tailExists = true;                break;            }        } while (actualPosition < bufferLength);    }    return outputOffset;",this.resampler=Function("bufferLength",t)},g.prototype.bypassResampler=function(t){return t},g.prototype.initializeBuffers=function(){var t=Math.ceil(this.inputBuffer.length*this.toSampleRate/this.fromSampleRate/this.channels*1.0000004768371582)*this.channels+this.channels;try{this.outputBuffer=new Float32Array(t),this.lastOutput=new Float32Array(this.channels)}catch(t){this.outputBuffer=[],this.lastOutput=[]}};const{STREAMING_MIN_RESPONSE:w}=a;function y(t,e,a){let n=[],i=0;for(let e=0;e<t.metadata.numberChannels;e++)n.push(new Int16Array(a));for(;i<a;){let s=t.getSamples(e+i,Math.min(t.metadata.samplesPerBlock,a-i));for(let t=0;t<s.length;t++)n[t].set(s[t],i);i+=Math.min(t.metadata.samplesPerBlock,a-i)}return n}let v=!1,S=null,b=null,k=null,M=null,R=!0,B=0,D=0,x=null,T=null,E=!1,W=!1,A=!1,C=!1,L=0,P=localStorage.getItem("volumeoverride")||1;function I(){p.updateState({position:D,paused:E,volume:P,loaded:L,looping:W})}async function O(t){let e=await fetch(t),a=await e.arrayBuffer();x=new m.Brstm(a),R=!0,B=Number.MAX_SAFE_INTEGER,L=Number.MAX_SAFE_INTEGER}function z(t){return new Promise((async(e,a)=>{let n,i;try{n=await fetch(t),i=(await n.body).getReader()}catch(t){return a(t)}T=new ArrayBuffer(parseInt(n.headers.get("content-length")));let s=new Uint8Array(T),o=0,l=!1,r=0;for(L=0,R=!1,A=!1;;){let t;try{t=await i.read()}catch(t){return void(l?(p.updateState({streamingDied:!0,buffering:!1,ready:!0}),await b.close(),b=null):a(t))}if(A)return await i.cancel(),void window.postMessage("continueload");if(t.done){if(!l)try{x=new m.Brstm(T),e(),l=!0}catch(t){return void a(t)}R=!0,L=Number.MAX_SAFE_INTEGER,console.log("File finished streaming");break}if(s.set(t.value,o),o+=t.value.length,B=o,0==r&&o>128){let t=0;65279==256*s[4]+s[5]&&(t=1),r=1==t?16777216*s[112]+65536*s[113]+256*s[114]+s[115]:s[112]+256*s[113]+65536*s[114]+16777216*s[115],r<144&&(r=w)}if(!l&&0!=r&&o>r)try{x=new m.Brstm(T),e(),l=!0}catch(t){return void a(t)}l&&(L=Math.floor((B-r)/x.metadata.numberChannels/x.metadata.blockSize)*x.metadata.samplesPerBlock)}}))}const F={setVolume:function(t){P=t,I(),M&&M.gain.setValueAtTime(P,b.currentTime)},seek:function(t){D=Math.floor(t),I()},pause:function(){E=!E,b[E?"suspend":"resume"](),I()},setLoop:function(t){W=t,I()}};window.player={play:async function(t){if(console.log(`playing ${t}`),v||(S=await async function(){let t={sampleRate:!1,streaming:!1};try{let e=new(window.AudioContext||window.webkitAudioContext)({sampleRate:8e3});t.sampleRate=8e3===e.sampleRate,e.close().then((()=>console.log("Closed capability detection audio context.")))}catch(t){console.log("WebAudio sample rate capability detection failed. Assuming fallback.")}try{let e=new Uint8Array(65536),a=new Blob([e],{type:"application/octet-stream"}),n=URL.createObjectURL(a),i=await fetch(n);const s=(await i.body).getReader();for(;!(await s.read()).done;);t.streaming=!0}catch(t){console.log("Streaming capability detection failed. Assuming fallback.")}var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),a=!!e&&parseInt(e[2],10);return!1!==a&&a>=89&&(t.sampleRate=!1,console.log("Chrome 89 or newer detected, using audio code workarounds.")),t}(),v=!0,p.runGUI(F),setInterval((function(){p.updateState({loaded:L}),p.guiUpdate()}),100)),C)return;var e,a,i;C=!0,R||(console.log("Cancelling last stream..."),A=!0,await(e="continueload",new Promise((function(t){window.addEventListener("message",(function a(n){n.data===e&&n.isTrusted&&(window.removeEventListener("message",a),t())}))}))),console.log("Done.")),b&&(await b.close(),b=null),D=0,E=!1,p.updateState({ready:!1,position:0,samples:1e6,loaded:0,volume:P,paused:!1,buffering:!1,sampleRate:44100,streamingDied:!1});try{await(S.streaming?z:O)(t)}catch(t){return p.updateState({streamingDied:!0,ready:!0,buffering:!1}),console.error(t),void(C=!1)}b=new(window.AudioContext||window.webkitAudioContext)(S.sampleRate?{sampleRate:x.metadata.sampleRate}:{}),W=1===x.metadata.loopFlag,await(a=b,new Promise((async function(t){let e=!1,n=document.createElement("div");n.style="background: #888a; z-index: 88888; position: fixed; top: 0; bottom: 0; left: 0; right: 0; display: flex; align-items: center; justify-content: center;";let i=document.createElement("div");i.style="display: flex; align-items: center; justify-content: center; flex-direction: column",i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" version="1.0"  width="200" height="200" viewBox="0 0 75 75">\n<path d="M39.389,13.769 L22.235,28.606 L6,28.606 L6,47.699 L21.989,47.699 L39.389,62.75 L39.389,13.769z"\nstyle="stroke:#fff;stroke-width:5;stroke-linejoin:round;fill:#fff;"\n/>\n<path d="M48,27.6a19.5,19.5 0 0 1 0,21.4M55.1,20.5a30,30 0 0 1 0,35.6M61.6,14a38.8,38.8 0 0 1 0,48.6" style="fill:none;stroke:#fff;stroke-width:5;stroke-linecap:round"/>\n</svg><h1 style="font-family: sans-serif; color: white; margin: 0;">Tap or click anywhere to enable audio.</h1>',n.appendChild(i),setTimeout((function(){e||document.body.appendChild(n)}),200),a.onstatechange=function(){"running"==a.state&&(t(),n.remove(),e=!0)};try{a.resume()}catch(t){console.error(t)}n.addEventListener("touchend",(async function(){await a.resume(),"running"===a.state&&(t(),n.remove(),e=!0)})),n.addEventListener("click",(async function(){await a.resume(),"running"===a.state&&(t(),n.remove(),e=!0)})),"running"===a.state&&(t(),n.remove(),e=!0)}))),S.streaming&&await(i=1e3,new Promise((t=>setTimeout(t,i)))),k=b.createScriptProcessor(0,0,2);let s=k.bufferSize;var o,l,r;s=S.sampleRate?s:(o=b.sampleRate,l=x.metadata.sampleRate,r=s,Math.ceil(r/o*l));let h=s;S.sampleRate||(h+=20),p.updateState({ready:!0,samples:x.metadata.totalSamples}),p.updateState({sampleRate:x.metadata.sampleRate}),C=!1,k.onaudioprocess=function(t){I();let e,a=t.outputBuffer;if(a.copyToChannel||(a.copyToChannel=n),D+s+1024>L)return p.updateState({buffering:!0}),console.log("Buffering...."),a.copyToChannel(new Float32Array(k.bufferSize).fill(0),0),void a.copyToChannel(new Float32Array(k.bufferSize).fill(0),1);if(p.updateState({buffering:!1}),E)return a.copyToChannel(new Float32Array(k.bufferSize).fill(0),0),void a.copyToChannel(new Float32Array(k.bufferSize).fill(0),1);if(D+h<x.metadata.totalSamples)e=y(x,D,h),D+=s;else if(W){e=y(x,D,x.metadata.totalSamples-D);let t=e[0].length;console.log(x.metadata.totalSamples-D,h-t);let a=y(x,x.metadata.loopStartSample,h-t);for(let t=0;t<e.length;t++){let n=new Int16Array(h).fill(0);n.set(e[t]),n.set(a[t],e[t].length),e[t]=n}D=x.metadata.loopStartSample+s-t}else{e=y(x,D,x.metadata.totalSamples-D-1);for(let t=0;t<e.length;t++){let a=new Int16Array(h).fill(0);a.set(e[t]),e[t]=a}D=0,E=!0,setTimeout((function(){b.suspend()}),200)}e.length>2&&(e=[e[0],e[1]]),1===e.length&&(e=[e[0],e[0]]);for(let t=0;t<e.length;t++){let n=new Float32Array(h);for(let a=0;a<h;a++)n[a]=e[t][a]/32768;if(!S.sampleRate){let t=new g(x.metadata.sampleRate,b.sampleRate,1,n);t.resampler(h),n=t.outputBuffer,n.length>k.bufferSize&&(n=n.slice(0,k.bufferSize))}a.copyToChannel(n,t)}},M=b.createGain(),k.connect(M),M.connect(b.destination),M.gain.setValueAtTime(P,b.currentTime)}}}();
