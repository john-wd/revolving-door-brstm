<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Test</title>
    <link rel="stylesheet" href="player.css" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
  </head>
  <body>
    Song id:<input type="number" min="0" max="99999" value="25772" id="song" />
    <button
      href="#"
      onclick="addToPlaylist(document.querySelector(`#song`).value)"
    >
      <span class="material-icons">playlist_add</span>
    </button>

    <br />
    <div>
      <button
        href="#"
        onclick="playSong(document.querySelector(`#song`).value)"
      >
        <span class="material-icons">play_arrow</span>
      </button>
      <button onclick="window.player.playPause()">
        <span class="material-icons">pause</span>
      </button>
      <button onclick="window.player.stop()">
        <span class="material-icons">stop</span>
      </button>
      <button onclick="window.player.previous()">
        <span class="material-icons">skip_previous</span>
      </button>
      <button onclick="window.player.next()">
        <span class="material-icons">skip_next</span>
      </button>
      <button onclick="window.player.decVolume(.1)">
        <span class="material-icons">volume_down</span>
      </button>
      <button onclick="window.player.incVolume(.1)">
        <span class="material-icons">volume_up</span>
      </button>
    </div>
    <h3>Playlist</h3>
    <button onclick="refreshPlaylist()">
      <span class="material-icons">refresh</span>
    </button>
    <button onclick="window.player.clearPlaylist()">
      <span class="material-icons">playlist_remove</span>
    </button>
    <ul id="playlist"></ul>
    <script src="dist/bundle.min.js"></script>
    <script>
      if (window.location.hash.length > 1) {
        if (window.location.hash.startsWith("#eval")) {
          eval(decodeURIComponent(window.location.hash.slice(5)));
        } else {
          let z = window.location.hash.slice(1);
          window.player.play(z);
        }
      }
      async function fetchSong(id) {
        return fetch(`https://smashcustommusic.net/json/song/${id}`);
      }
      async function playSong(id) {
        fetchSong(id).then(async (resp) => {
          if (resp.status >= 400) {
            return;
          }
          song = await resp.json();
          window.player.init({
            id: id,
            name: song.name,
            length: song.length,
            loop: song.loop_type,
            uploader: song.uploader,
            available: song.available,
            downloads: song.downloads,
            game_name: song.game_name,
          });
          refreshPlaylist();
        });
      }
      async function addToPlaylist(id) {
        fetchSong(id).then(async (resp) => {
          if (resp.status >= 400) {
            return;
          }
          song = await resp.json();
          window.player.addToPlaylist({
            id: id,
            name: song.name,
            length: song.length,
            loop: song.loop_type,
            uploader: song.uploader,
            available: song.available,
            downloads: song.downloads,
            game_name: song.game_name,
          });
          refreshPlaylist();
        });
      }
      function refreshPlaylist() {
        let ul = document.getElementById("playlist");
        if (!ul) {
          return;
        }
        ul.innerHTML = "";
        window.player.playlist.forEach((s) => {
          let li = document.createElement("li");
          li.innerText = s.name;
          li.id = s.id;
          ul.appendChild(li);
        });
      }
    </script>
  </body>
</html>
